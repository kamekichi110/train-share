<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>乗り換え案内</title>
    <link rel="shortcut icon" href="../../asset/icon/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/index.css">
    <script src="../../js/main.js"></script>
    <script src="./search.js" charset="UTF-8"></script>
    <script charset="UTF-8">
function search_list() {
    var from = document.getElementById("from").value;
    var for0 = document.getElementById("for").value;
    var via = document.getElementById("via-sec").value + document.getElementById("via").value;
    var URL0 = "https://api.ekispert.jp/v1/xml/search/course/light?from=";
    var URL1 = "&to=";
    var URL3 = "&shinkansen=";
    var shinkansen = document.getElementById("shinkansen").value;
    var URL4 = "&limitedExpress=";
    var exp = document.getElementById("exp").value;
    var URL5 = "&redirect=true&contentsMode=sp";
    var URL6 = "&key=";
    var key = "LE_DDLV9n4GxgPku";
    var plane = document.getElementById("plane").value;
    var date = document.getElementById("date").value;
    var time = document.getElementById("time").value;
    var slice0 = time.replace(":", "");
    var type0 = document.getElementById("type0").value;
    var dateSet = date.replace("-", "");
    var DateValue = "&date=" + dateSet.replace("-", "");
    var TimeValue = "&time=" + slice0.slice(0, 4);
    var TypeValue = "&searchType=" + type0;
    var searchType = DateValue + TimeValue + TypeValue;
    var urlLink = URL0 + from + URL1 + for0 + via + plane + URL3 + shinkansen + URL4 + exp + searchType + URL5 +URL6 + key;
    var textURL = document.getElementById("url");
    console.log(urlLink);
    alert('検索完了しました。表示されるまでお待ちください。');
    textURL.innerHTML = `<p><a href='${urlLink}>表示が変わらない方はこちら</a></p>`;
    setTimeout(() => {
        alert('表示の準備ができました。表示します。')
        window.location.href = urlLink;
    }, 2000);
}
    </script>
</head>
<body>
    <header>
        <img src="https://kamekichi110.github.io/train-share/asset/icon/main.png" class="icon" alt="icon">
        <h2>
          Train-Share
          <br>
          鉄道情報掲載サイト
        </h2>
      </header>
      <article>
        <br>
        <section>
          <h3>乗り換え案内</h3>
          <p>使用API:駅すぱあとWebサービス</p>
          <p>乗り換え案内検索ができます。</p>
          <p>使い方<a href="./video/index.html">こちら</a></p>
          <br>
          <h6>最寄り駅検索&経路検索ツール</h6>
          <p>利用は<a href="../../sta-position/change.html">こちら</a>から</p>
          <br>
        </section>
        <br>
        <main>
            <h4>ステップ1:出発駅を入力</h4>
            <p><input type="text" id="from" placeholder="出発駅を入力" onchange="box0()">駅
                <br>
                候補駅を選択:<select name="area0" id="FromArea" onchange="area0()">
                <option value="">候補駅を選択</option>
                </select>
                <br>
                候補駅がない場合はそのまま
                <br>              
                次のステップに進んでください。          
            </p>
            <hr>
            <h4>ステップ2:到着駅を入力</h4>
            <p><input type="text" id="for" placeholder="到着駅" onchange="box1()">駅
                <br>
                候補駅を選択:<select name="area1" id="ForArea" onchange="area1()">
                <option value="">候補駅を選択</option>
                </select>
                <br>
                候補駅がない場合はそのまま
                <br>
                次のステップに進んでください。
            <br>
            </p>
            <hr>
            <h4>ステップ3:経由地を指定</h4>
            <p>※ない場合はステップ4へ。</p>
            <p><select name="via-list_" id="via-sec">
                <option value="">経由地なし</option>
                <option value="&via=">経由地あり</option>
            </select>
                <input type="text" id="via" onchange="via()">
                <br>
                候補駅を選択:<select name="viaArea_" id="ViaArea" onchange="ViaList()">
                <option value="">候補駅を選択</option>
                </select>
                <br>
                候補駅がない場合はそのまま
                <br>
                次のステップに進んでください。
            </p>
            <hr>
            <h4>ステップ4:検索設定</h4>
            <p>新幹線:
                <select name="type_" id="shinkansen">
                    <option value="false">利用しない</option>
                    <option value="true">利用する</option>
                </select>
            </p>
            <p>特急:
                <select name="exp_" id="exp">
                    <option value="false">利用しない</option>
                    <option value="true">利用する</option>
                </select>
            </p>
            <p>飛行機:
                <select name="plane_" id="plane">
                    <option value="&plane=false">利用しない</option>
                    <option value="&plane=true">利用する</option>
                </select>
            </p>
            <br>
            <hr>
            <br>
            <h4>日時選択(<span style="color: red;">※必須</span>)</h4>
            <p>日付:<input type="date" id="date"></p>
            <p>時間:<input type="time" id="time"></p>
            <p>検索種別:
                <select id="type0">
                    <option value="departure">出発</option>
                    <option value="arrival">到着</option>
                </select>
            </p>
            <br>
            <hr>
            <br>
            <h4>ステップ5:検索ボタンをクリック！</h4>
            <button onclick="search_list()">検索!</button>
            <br>
            <br>
            <button type="button" onclick="clearText()">駅名入力を初期化</button>
            <br>
            <br>
            <div id="url"></div>
            <br>
            <hr>
            <br>
        </main>
        <br>
        <div class="footer">
          <p id="day"></p>
          <p>
            <br>管理者X(旧Twitter)<a href="https://twitter.com/sirokuma_8110F">link</a>
            <br>各種ツール
            <br><a href="https://kamekichi110.github.io/train-share/view/train-info.html">列車情報ビューアー</a>
            <a href="https://kamekichi110.github.io/train-share/photo/index.html">思い出写真</a>
          <a href="https://kamekichi110.github.io/train-share/index.html">home</a>
          </p>
        </div>
      </article>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
  setTimeout(function () {
    const dateInput = document.getElementById('date');
    const timeInput = document.getElementById('time');

    const currentDate = new Date();
    const currentDateString = currentDate.toISOString().split('T')[0];
    const currentTimeString = currentDate.toTimeString().split(' ')[0];

    dateInput.value = currentDateString;
    timeInput.value = currentTimeString;
  }, 200);
});

      </script>
</body>
</html>