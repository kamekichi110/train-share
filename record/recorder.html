<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
  <style>
      body {
            font-family: Arial, sans-serif;
                  text-align: center;
                      }

                          .controls {
                                margin: 20px;
                                    }

                                        .btn {
                                              padding: 10px 20px;
                                                    font-size: 16px;
                                                        }

                                                            .audio-controls {
                                                                  margin: 20px;
                                                                      }

                                                                          .settings {
                                                                                margin: 20px;
                                                                                    }

                                                                                        select {
                                                                                              padding: 5px;
                                                                                                    font-size: 14px;
                                                                                                        }

                                                                                                            label {
                                                                                                                  margin-right: 10px;
                                                                                                                      }
                                                                                                                      
                                                                                                                        </style>
                                                                                                                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                                                                                                        <meta charset="utf-8">
                                                                                                                        <title>MediaRecorder</title>
                                                                                                                        </head>
                                                                                                                        <body>
                                                                                                                          <div class="controls">
                                                                                                                              <button id="recordButton" class="btn">録音開始</button>
                                                                                                                                  <button id="stopButton" class="btn" disabled>録音停止</button>
                                                                                                                                    </div>
                                                                                                                                      <div class="audio-controls">
                                                                                                                                          <audio id="audioPlayer" controls></audio>
                                                                                                                                            </div>
                                                                                                                                              <div class="settings">
                                                                                                                                                  <label for="sampleRateSelect">サンプリングレート:</label>
                                                                                                                                                      <select id="sampleRateSelect">
                                                                                                                                                            <option value="44100">44.1 kHz</option>
                                                                                                                                                                  <option value="48000">48 kHz</option>
                                                                                                                                                                        <option value="96000">96 kHz</option>
                                                                                                                                                                            </select>
                                                                                                                                                                                <label for="bitDepthSelect">ビット深度:</label>
                                                                                                                                                                                    <select id="bitDepthSelect">
                                                                                                                                                                                          <option value="16">16 bit</option>
                                                                                                                                                                                                <option value="24">24 bit</option>
                                                                                                                                                                                                      <option value="32">32 bit</option>
                                                                                                                                                                                                          </select>
                                                                                                                                                                                                            </div>
                                                                                                                                                                                                              <script>
                                                                                                                                                                                                                  const recordButton = document.getElementById('recordButton');
                                                                                                                                                                                                                      const stopButton = document.getElementById('stopButton');
                                                                                                                                                                                                                          const audioPlayer = document.getElementById('audioPlayer');
                                                                                                                                                                                                                              const sampleRateSelect = document.getElementById('sampleRateSelect');
                                                                                                                                                                                                                                  const bitDepthSelect = document.getElementById('bitDepthSelect');

                                                                                                                                                                                                                                      let mediaRecorder;
                                                                                                                                                                                                                                          let audioChunks = [];
                                                                                                                                                                                                                                              let audioConstraints = {
                                                                                                                                                                                                                                                    audio: {
                                                                                                                                                                                                                                                            sampleRate: 44100,
                                                                                                                                                                                                                                                                    channelCount: 2,
                                                                                                                                                                                                                                                                            bitDepth: 16,
                                                                                                                                                                                                                                                                                  },
                                                                                                                                                                                                                                                                                      };

                                                                                                                                                                                                                                                                                          sampleRateSelect.addEventListener('change', updateAudioConstraints);
                                                                                                                                                                                                                                                                                              bitDepthSelect.addEventListener('change', updateAudioConstraints);

                                                                                                                                                                                                                                                                                                  function updateAudioConstraints() {
                                                                                                                                                                                                                                                                                                        audioConstraints.audio.sampleRate = parseInt(sampleRateSelect.value);
                                                                                                                                                                                                                                                                                                              audioConstraints.audio.bitDepth = parseInt(bitDepthSelect.value);
                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                      recordButton.addEventListener('click', startRecording);
                                                                                                                                                                                                                                                                                                                          stopButton.addEventListener('click', stopRecording);

                                                                                                                                                                                                                                                                                                                              async function startRecording() {
                                                                                                                                                                                                                                                                                                                                    try {
                                                                                                                                                                                                                                                                                                                                            const stream = await navigator.mediaDevices.getUserMedia(audioConstraints);
                                                                                                                                                                                                                                                                                                                                                    mediaRecorder = new MediaRecorder(stream);

                                                                                                                                                                                                                                                                                                                                                            mediaRecorder.ondataavailable = (e) => {
                                                                                                                                                                                                                                                                                                                                                                      if (e.data.size > 0) {
                                                                                                                                                                                                                                                                                                                                                                                  audioChunks.push(e.data);
                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                    };

                                                                                                                                                                                                                                                                                                                                                                                                            mediaRecorder.onstop = () => {
                                                                                                                                                                                                                                                                                                                                                                                                                      const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                                                                                                                                                                                                                                                                                                                                                                                                                                audioChunks = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                          const audioUrl = URL.createObjectURL(audioBlob);
                                                                                                                                                                                                                                                                                                                                                                                                                                                    audioPlayer.src = audioUrl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                            };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                    mediaRecorder.start();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            recordButton.disabled = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    stopButton.disabled = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  console.error('録音を開始できません: ', error);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function stopRecording() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      mediaRecorder.stop();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            recordButton.disabled = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  stopButton.disabled = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </html>
